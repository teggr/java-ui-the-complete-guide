name: Copilot Java 25 Workflow

on:
  workflow_dispatch:
  pull_request:
    types: [opened, synchronize, reopened]

permissions:
  contents: read
  actions: read

jobs:
  setup-java-25:
    name: Setup Java 25 Environment
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Java 25
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '25'

      - name: Setup JBang
        uses: jbangdev/setup-jbang@v0.1.1

      - name: Cache JBang dependencies
        uses: actions/cache@v4
        with:
          path: |
            ~/.jbang
          key: ${{ runner.os }}-jbang-${{ hashFiles('**/*.java') }}
          restore-keys: |
            ${{ runner.os }}-jbang-

      - name: Verify Java installation
        run: |
          java -version
          echo "JAVA_HOME=$JAVA_HOME"

      - name: Verify JBang installation
        run: |
          jbang version
      
      - name: Test build with Java 25
        run: |
          jbang run build.java
      
      - name: Upload build artifacts
        uses: actions/upload-artifact@v4
        with:
          name: site-build
          path: _site/
